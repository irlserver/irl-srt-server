srt {
    ########################################################################
    # GLOBAL SRT SERVER SETTINGS
    ########################################################################

    worker_threads 1;                  # Worker threads for handling SRT connections
                                       # Increase if handling many streams (>5 simultaneous)

    worker_connections 300;            # Max concurrent SRT connections per worker

    http_port 8181;                    # Stats API: http://<host>:8181/stats
    cors_header *;                     # Allow all origins (set specific domain for security)

    log_file logs/srt_server.log;      # Log file (change path if running as a service)
    log_level info;                    # trace | debug | info | warn | error

    pidfile /tmp/sls/sls_server.pid;   # PID file (auto-created/deleted on start/stop)

    # API keys for accessing /stats without requiring ?publisher= param
    # Pass in HTTP header: Authorization: <key>
    #api_keys key1,another-secure-key,key3;

    # Auto-post stats to an external service
    #stat_post_url http://127.0.0.1:8001/sls/stat;
    stat_post_interval 1;              # Interval (seconds) for posting stats if enabled

    # HLS recording base directory (default off in servers below)
    #record_hls_path_prefix /tmp/mov/sls;
    # Example VOD path:
    #   /tmp/mov/sls/<listen>/<domain_publisher>/<app_publisher>/<stream_name>/vod.m3u8

    ########################################################################
    # 1 MOBILE / IRL / GENERAL SERVER (Tuned for 4G/5G Streaming)
    # NEW: Separate publisher and player ports for better organization
    ########################################################################
    server {
        # NEW: Separate ports for players and publisher
        listen_player 4000;           # Players connect here: srt://<host>:30001?streamid=play/live/<stream>
        listen_publisher 4001;        # Publishers connect here: srt://<host>:30000?streamid=publish/live/<stream>
        
        # Legacy single port (kept for backwards compatibility when using older configs)
        listen 4001;                  # Legacy port - will use listen_publisher if both are specified
        
        latency_min 200;               # Minimum latency for publishers (ms) - enforced on publisher listener socket
        latency_max 5000;              # Maximum latency for all connections (ms) - prevents excessive delays

        domain_player play;             # Playback domain (used in stats & HLS path)
        domain_publisher publish;       # Publishing domain
        default_sid publish/live/feed1; # Default StreamID if encoder omits one

        backlog 100;                    # Max simultaneous connection attempts
        idle_streams_timeout 10;        # Close idle streams after 10s (-1 = unlimited)

        # Webhook for events (optional)
        #on_event_url http://127.0.0.1:8000/sls/on_event;
        # Callback format:
        #   ?method=on_connect|on_close&role_name=&srt_url=<stream_url>

        # Player key authentication (optional)
        # When enabled, player connections using the configured domain_player/app_player format
        # will have the stream name validated as a player key against the API endpoint
        # The API endpoint should return the actual stream ID that the player key maps to
        #player_key_auth_url http://127.0.0.1:8000/sls/validate_player_key;
        # API call format:
        #   GET <player_key_auth_url>?player_key=<key>
        # Expected response format (JSON only):
        #   {"stream_id": "publish/live/actualstream"}
        # 
        # Example usage with this configuration (domain_player=play, app_player=live):
        #   Player connects: srt://host:port?streamid=play/live/abc123
        #   API validates "abc123" and returns: {"stream_id": "publish/live/mystream"}
        #   Player gets connected to the actual "mystream"

        app {
            app_player live;            # Player app name: srt://<host>:30001?streamid=play/live/<stream>
            app_publisher live;         # Publisher app name: srt://<host>:30000?streamid=publish/live/<stream>

            # Security: Control who can publish or play
            #deny publish 123.123.123.123; # Block specific IPs from publishing
            allow publish all;             # Allow all publishers

            #deny play 123.123.123.123;     # Block specific IPs from playback
            allow play all;                # Allow all players

            record_hls off;             # HLS recording disabled (set to "on" to enable)
            record_hls_segment_duration 10; # Length of each HLS .ts segment (seconds)
        }
    }

    ########################################################################
    # 2 LOW-LATENCY SERVER (LAN / Studio / High-Quality Networks)
    ########################################################################
    server {
        # Separate ports for low-latency streaming
        listen_publisher 30002;        # Low-latency publishers: srt://<host>:30002?streamid=publish/live/<stream>
        listen_player 30003;           # Low-latency players: srt://<host>:30003?streamid=play/live/<stream>
        
        # Legacy port (kept for backwards compatibility)
        listen 30002;                  # Legacy port - will use listen_publisher if both are specified
        
        latency_min 20;                # Minimum latency for publishers (ms) - enforced on publisher listener socket
        latency_max 1000;              # Maximum latency for all connections (ms) - low latency server

        domain_player play;
        domain_publisher publish;
        default_sid publish/live/feed1;

        backlog 100;
        idle_streams_timeout 3;

        # Player key authentication (optional)
        # Uses configured domain_player/app_player format for validation
        #player_key_auth_url http://127.0.0.1:8000/sls/validate_player_key;

        app {
            app_player live;            # Player app name: srt://<host>:30003?streamid=play/live/<stream>
            app_publisher live;         # Publisher app name: srt://<host>:30002?streamid=publish/live/<stream>

            allow publish all;
            allow play all;
            
            # Limit the number of players per stream (-1 = unlimited, 0+ = max players)
            max_players_per_stream 3;
            
            record_hls off; # on, off 
            record_hls_segment_duration 10; # unit s
            
            # Maximum input bitrate per stream in kilobits per second (0 = unlimited)  
            # max_input_bitrate_kbps 20000; # 20 Mbps limit
            
            # Timeout in seconds before disconnecting streams that violate bitrate limits
            # max_input_bitrate_violation_timeout 30; # 30 seconds (default)
            
            # relay {
            #     type pull;
            #     mode loop; # loop; hash;
            #     reconnect_interval 10;
            #     idle_streams_timeout -1; # s -1: unlimited
            #     upstreams 127.0.0.1:9090?streamid=live.sls.com/live 192.168.1.100:8080/?streamid=live.test.com/live;
            # }
            # relay {
            #     type push;
            #     mode all; # all; hash
            #     reconnect_interval 10;
            #     idle_streams_timeout 10; # s -1: unlimited
            #     upstreams srt://10.201.30.10:8080/?streamid=uplive.sls/live/{stream_name};
            # }
        }
    }
}
